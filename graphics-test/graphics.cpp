#include <stddef.h>
#include <stdint.h>
#include <stdbool.h>
#include <stddef.h>

#include "sbapi_graphics.h"

uint8_t VRAM[SCR_RAMSIZE];

uint32_t CRAM[256] = {
    0x00000000, 0x00AFAFAF, 0x00FFFFFF, 0x003B67A2, 0x00AA907C, 0x00959595, 0x007B7B7B, 0x00FFA997,
    0x0037A91D, 0x007CA9FF, 0x00BF8112, 0x00EBBF66, 0x0078C178, 0x003D9318, 0x00B33418, 0x00D9311C,
    0x00000000, 0x0000001C, 0x00000039, 0x00000055, 0x00000071, 0x0000018E, 0x000001AA, 0x000001C6,
    0x000001E3, 0x000001FF, 0x00CECECE, 0x0000FF00, 0x00B2FF00, 0x00FFE700, 0x00FF9600, 0x00FF1100,
    0x00491200, 0x00491355, 0x004914AA, 0x004916FF, 0x005B1700, 0x005B1855, 0x005B19AA, 0x005B1AFF,
    0x006D1B00, 0x006D1C55, 0x0000E300, 0x0085FF54, 0x00C4FF00, 0x00FFD900, 0x00FFA41F, 0x00E05400,
    0x00FF0000, 0x00922655, 0x009227AA, 0x009228FF, 0x00A42900, 0x00A42A55, 0x00A42BAA, 0x00A42CFF,
    0x00B62D00, 0x00B62F55, 0x00B630AA, 0x00B631FF, 0x00C93200, 0x00C93355, 0x00C934AA, 0x00C935FF,
    0x00DB3700, 0x00DB3855, 0x00DB39AA, 0x00DB3AFF, 0x00ED3B00, 0x00ED3C55, 0x00ED3DAA, 0x00ED3FFF,
    0x00FF4000, 0x00FF4155, 0x00FF42AA, 0x00FF43FF, 0x00004400, 0x00004555, 0x000046AA, 0x000048FF,
    0x00FFFF00, 0x0012FF55, 0x0012EE55, 0x0012B6FF, 0x00001FFF, 0x009D0EC7, 0x00F10000, 0x00FF7700,
    0x00375200, 0x00375355, 0x003754AA, 0x003755FF, 0x00495600, 0x00495855, 0x004959AA, 0x00495AFF,
    0x005B5B00, 0x005B5C55, 0x005B5DAA, 0x005B5EFF, 0x006D6000, 0x006D6155, 0x006D62AA, 0x006D63FF,
    0x006D6400, 0x00806555, 0x008066AA, 0x008067FF, 0x00926900, 0x00926A55, 0x00926BAA, 0x00926CFF,
    0x00A46D00, 0x00A46E55, 0x00A46FAA, 0x00A471FF, 0x00B67200, 0x00B67355, 0x00B674AA, 0x00B675FF,
    0x00C97600, 0x00C97755, 0x00C979AA, 0x00C97AFF, 0x00DB7B00, 0x00DB7C55, 0x00DB7DAA, 0x00DB7EFF,
    0x00ED7F00, 0x00ED8055, 0x00ED82AA, 0x00ED83FF, 0x00FF8400, 0x00FF8555, 0x00FF86AA, 0x00FF87FF,
    0x00008800, 0x00008A55, 0x00008BAA, 0x00008CFF, 0x00128D00, 0x00128E55, 0x00128FAA, 0x001290FF,
    0x00249200, 0x00249355, 0x002494AA, 0x002495FF, 0x00379600, 0x00379755, 0x003798AA, 0x003799FF,
    0x00499B00, 0x00499C55, 0x00499DAA, 0x00499EFF, 0x005B9F00, 0x005BA055, 0x005BA1AA, 0x005BA3FF,
    0x00A4B5D5, 0x00A0B0F8, 0x0094A3E6, 0x007C89C1, 0x006281C0, 0x001C62A1, 0x004254EA, 0x0062A1BD,
    0x007093C0, 0x004977A1, 0x00003FAA, 0x001554FF, 0x001C50B9, 0x0000B3FF, 0x000088AA, 0x0000B5FF,
    0x000E62FF, 0x005EB7E3, 0x00BDC0B9, 0x0085B9FF, 0x00006CAF, 0x001F81B9, 0x003F5BAA, 0x00C9BEFF,
    0x005BAFCB, 0x00DBC055, 0x00DBC1AA, 0x00BDC0C0, 0x00EDC400, 0x00EDC555, 0x00EDC6AA, 0x00EDC7FF,
    0x00FFC800, 0x00FFC955, 0x00FFCAAA, 0x00FFCCFF, 0x0000CD00, 0x0000CE55, 0x0000CFAA, 0x0000D0FF,
    0x0012D100, 0x0012D255, 0x0012D3AA, 0x0012D5FF, 0x0024D600, 0x0024D755, 0x0024D8AA, 0x0024D9FF,
    0x00100020, 0x001B0029, 0x00250032, 0x0030003A, 0x003B0043, 0x0045004C, 0x00500055, 0x0049E2FF,
    0x005BE300, 0x005BE555, 0x005BE6AA, 0x005BE7FF, 0x006DE800, 0x006DE955, 0x006DEAAA, 0x006DEBFF,
    0x006DEC00, 0x0080EE55, 0x0080EFAA, 0x0080F0FF, 0x0093CEA2, 0x0092F255, 0x0092F3AA, 0x0092F4FF,
    0x00A4F600, 0x00A4F755, 0x00A4F8AA, 0x00A4F9FF, 0x00B6FA00, 0x00B6FB55, 0x00B6FCAA, 0x00B6FEFF,
    0x00C9FF00, 0x00C9FF55, 0x00C9FFAA, 0x00C9FFFF, 0x00DBFF00, 0x00DBFF55, 0x00DBFFAA, 0x00DBFFFF,
    0x00EDFF00, 0x00EDFF55, 0x00EDFFAA, 0x00EDFFFF, 0x00FFFF00, 0x00FFFF55, 0x00FFFFAA, 0x00FFFFFF,
};

void sbgfx_pset(int16_t x, int16_t y, uint8_t cindex){
    if ((unsigned)x >= SCR_WIDTH || (unsigned)y >= SCR_HEIGHT)
        return;

    uint8_t *vmem = VRAM + (y * SCR_WIDTH + x);
    *vmem = cindex;
}


void sbgfx_fill(uint8_t colour){
    for (int i = 0; i < SCR_RAMSIZE; i++)
        VRAM[i] = colour;
}


void sbgfx_drawbox(int x, int y, int w, int h, uint8_t col){
    // Clip to screen bounds
    if (x < 0) { w += x; x = 0; }
    if (y < 0) { h += y; y = 0; }
    if (x + w > SCR_WIDTH) w = SCR_WIDTH - x;
    if (y + h > SCR_HEIGHT) h = SCR_HEIGHT - y;
    if (w <= 0 || h <= 0) return;

    for (int fy = 0; fy < h; fy++) {
        uint8_t *row = VRAM + (y + fy) * SCR_WIDTH + x;
        for (int fx = 0; fx < w; fx++) {
            row[fx] = col;
        }
    }
}

